<sect2 id="using-setup-database">
    <title
>Параметры базы данных</title>

    <para>

        <note
><para
>Для ознакомления с внутренним хранилищем данных обратитесь к разделу «<link linkend="intro-database"
>Введение в базы данных &digikam;</link
>». </para
></note>

    </para>

    <sect3 id="using-setup-database-sqlite">
        <title
>База данных SQLite</title>

        <para
><ulink url="https://sqlite.org"
>SQLite</ulink
> — это система управления реляционными базами данных, содержащаяся в библиотеке программирования на языке C. SQLite не сопоставим напрямую с клиент-серверными базами данных SQL, такими как MySQL, Oracle или PostgreSQL. Это, скорее, встроенный компонент ядра базы данных SQL, то есть он встроен в конечную программу. SQLite считывает и записывает напрямую в обычные файлы на диске. Для локального хранилища на устройстве с низким параллелизмом записи и объёмом содержимого менее терабайта SQLite почти всегда является лучшим решением. SQLite быстр и надёжен и не требует настройки или обслуживания. Он всё упрощает и «просто работает». </para>

        <para
>По умолчанию &digikam; использует SQLite в качестве серверной части для хранения важных метаданных и миниатюр. Для этого используются три файла SQLite: <orderedlist>

                <listitem
><para
>Ядро: digikam4.db. </para
></listitem>

                <listitem
><para
>Миниатюры: thumbnails-digikam.db. </para
></listitem>

                <listitem
><para
>Лица: recognition.db. </para
></listitem>

            </orderedlist>

        </para>

        <para
>Чтобы приложение работало быстро и плавно, рекомендуется периодически проверять и оптимизировать базы данных. Это возможно сделать с помощью пакетов sqlite3 или браузера sqlite (высококачественный, простой в использовании виртуальный инструмент для управления объектами баз данных). Для Ubuntu и его производных этот инструмент возможно установить с помощью команды <command
>sudo apt-get install sqlite3</command
> или <command
>sudo apt-get install sqlitebrowser</command
>. Всё, что остаётся, это открыть терминал и переключиться в каталог, где хранятся базы данных. </para>

        <note
><para
>Позаботьтесь о том, чтобы использовать место, размещённое на быстром оборудовании (например, на твердотельном накопителе), с достаточным количеством свободного места, особенно для базы данных миниатюр. Нельзя использовать удалённую файловую систему, например NFS, а также по причинам производительности и техническим причинам нельзя использовать съёмные носители. </para
></note>

        <para
>Файлы базы данных SQLite возможно найти в папке «коллекция», добавленной вручную в &digikam; (по умолчанию при добавлении коллекции «Изображения» файлы базы данных будут располагаться в папке <filename class="directory"
> ~/Изображения</filename
>). </para>

        <para>
            <inlinemediaobject
><imageobject>
                <imagedata fileref="&path;intro-database-sqlite.png" format="PNG"/></imageobject>
            </inlinemediaobject>
        </para>

    </sect3>

    <sect3 id="using-setup-database-mysql">
        <title
>База данных MySQL</title>

        <sect4>
            <title
>MySQL против SQLite</title>

            <para
><ulink url="https://www.mysql.com"
>MySQL</ulink
> — это система управления реляционными базами данных с открытым исходным кодом, написанная на языках C и C++. Первоначальную разработку MySQL инициировали в 1994 году Michael Widenius и David Axmark. В 2008 году MySQL была приобретена Sun Microsystems, а в 2010 году — Oracle. В настоящее время MySQL работает практически на всех системных платформах (Linux, Microsoft Windows, OS X, SunOS и так далее). </para>

            <para
>Сервер <ulink url="https://mariadb.org/"
>MariaDB</ulink
> — это разработанное сообществом ответвление от MySQL-сервера. MariaDB, созданная основными членами первоначальной команды MySQL, активно сотрудничает с внешними разработчиками, чтобы предоставить наиболее функциональный, стабильный и лицензированный открытый SQL-сервер в отрасли. </para>

            <para
>MariaDB фактически обогнала MySQL по нескольким основным причинам: <orderedlist>

                    <listitem
><para
>Разработка MariaDB более открытая и динамичная. </para
></listitem>

                    <listitem
><para
>Больше передовых функций. </para
></listitem>

                    <listitem
><para
>Больше систем хранения. </para
></listitem>

                    <listitem
><para
>Лучшая производительность. </para
></listitem>

                    <listitem
><para
>Совместимость и лёгкий перенос. </para
></listitem>

                </orderedlist>

            </para>

            <para
>&digikam; также обеспечивает поддержку популярного движка баз данных MySQL. Возникает закономерный вопрос, зачем переходить на MySQL, когда SQLite и так хорошо справляется с управлением данными? MySQL предлагает множество преимуществ для хранения данных &digikam;, особенно когда коллекции содержат более 100 000 элементов. При таких больших коллекциях в SQLite происходит задержка, которая замедляет работу приложения. </para>

            <para
>Использование MySQL в качестве серверной части базы данных &digikam; позволяет хранить данные как на локальном, так и на удалённом сервере. Локальный — для замены локального хранилища SQLite, удалённый — для использования общего компьютера через сеть. Использование MySQL в качестве серверной части базы данных &digikam; позволяет хранить данные на удалённом сервере. Таким образом, возможно использовать несколько установок &digikam; (например, на своём ноутбуке и ПК) для доступа и управления своими коллекциями фотографий. Также возможно использовать инструменты MySQL для резервного копирования и анализа данных &digikam;. </para>

            <para
>Чтобы переключиться с базы данных SQLite на MySQL, перейдите в меню <guimenuitem
>Настройка</guimenuitem
> / <guimenuitem
>Настроить &digikam;...</guimenuitem
> и в разделе <guilabel
>Базы данных</guilabel
> выберите нужную базу данных из раскрывающегося списка. <orderedlist>

                    <listitem
><para
>Встроенная MySQL: позволяет запускать внутренний сервер базы данных. &digikam; использует сокет Unix для соединения. </para
></listitem>

                    <listitem
><para
>Сервер MySQL: подходит для использования в случае, если данные находятся на удалённом сервере, а пользователь использует другую аппаратную платформу, чтобы получить доступ к коллекции. </para
></listitem>

                </orderedlist>

            </para>

        </sect4>

        <sect4>
            <title
>Встроенный сервер MySQL</title>

            <para
>При использовании коллекции, размер которой превышает 100 000 элементов, приложение может замедлиться. Чтобы избежать задержек и не терять производительность, &digikam; позволяет использовать <guilabel
>Встроенный сервер MySQL</guilabel
>. На самом деле это не настоящий сервер или публичная сеть, это сервер, который запускается только во время работы приложения. </para>

            <para
>Внутренний сервер создаёт отдельную базу данных, доступ к которой возможно получить (только во время работы приложения) с помощью команды: <command
>mysql --socket=/home/<replaceable
>[имя_пользователя]</replaceable
>/.local/share/digikam/db_misc/mysql.socket digikam</command
>. </para>

            <para
>Внутренний сервер использует два бинарных инструмента MySQL: <application
>mysql_install_db</application
> и <application
>mysqld</application
>. Их расположение указывается в диалоге настройки. &digikam; автоматически попытается найти эти инструменты, если они установлены в системе. </para>

            <para>
                <inlinemediaobject
><imageobject>
                    <imagedata fileref="&path;intro-database-mysqlinternal.png" format="PNG"/></imageobject>
                </inlinemediaobject>
            </para>

        </sect4>

        <sect4>
            <title
>Удалённый сервер MySQL</title>

            <para
>Для использования удалённого сервера MySQL в &digikam; потребуется наличие сервера MySQL. Или для этих же целей возможно установить MariaDB (например по этой <ulink url="http://www.liquidweb.com/kb/how-to-install-mariadb-5-5-on-ubuntu-14-04-lts/"
>ссылке</ulink
>). </para>

            <para
>Следуйте приведённым ниже инструкциям, если нет выделенной учётной записи пользователя и уже настроенной базы данных &digikam;. Запустите следующие команды на сервере MySQL (заменив слово «пароль» корректным паролем): </para>

            <note
><para
>Возможно выбрать любое название для базы данных (в нашем случае это «digikam»). Главное, не забыть заполнить правильно имена баз данных Ядра, Миниатюр и Лиц в диалоговом окне, изображённом ниже. </para
></note>

            <blockquote
><screen
>CREATE USER ''@'%' IDENTIFIED BY 'пароль';
                GRANT ALL ON *.* TO ''@'%' IDENTIFIED BY 'пароль';
                CREATE DATABASE digikam;
                GRANT ALL PRIVILEGES ON digikam.* TO ''@'%';
                FLUSH PRIVILEGES;
            </screen
></blockquote>

            <note
><para
>Если коллекция огромная, рекомендуется запустить сервер MySQL с командой <command
>mysql --max_allowed_packet = 128M</command
>. </para
></note>

            <para
>Теперь в &digikam; перейдите в <menuchoice
><guimenu
>Настройка</guimenu
> <guimenuitem
>Настроить &digikam;...</guimenuitem
></menuchoice
> и в разделе <guilabel
>Базы данных</guilabel
> из раскрывающегося списка выберите опцию <guilabel
>Сервер MySQL</guilabel
>. </para>

            <para>
                <inlinemediaobject
><imageobject>
                    <imagedata fileref="&path;intro-database-remotemysql.png" format="PNG"/></imageobject>
                </inlinemediaobject>
            </para>

            <para
>Введите IP-адрес сервера MySQL в поле ввода <guilabel
>Имя хоста</guilabel
> и корректный порт в поле <guilabel
>Порт</guilabel
> (по умолчанию установлено значение 3306). </para>

            <para
>Введите название первой базы данных для хранения метаданных фото в поле <guilabel
>Имя главной БД</guilabel
>. </para>

            <para
>Укажите название второй базы данных для хранения сжатых вейвлетов миниатюр в поле <guilabel
>Имя БД миниатюр</guilabel
>.  </para>

            <para
>Третья база данных предназначена для хранения гистограмм лиц с целью их распознавания на изображениях. Название этой базы данных запишите в поле <guilabel
>Название БД меток лиц</guilabel
>. </para>

            <para
>Для безопасного подключения к удалённому серверу введите идентификационные данные MySQL в поля ввода <guilabel
>имя пользователя</guilabel
> и <guilabel
>пароль</guilabel
>. </para>

            <para
>Чтобы проверить, правильно ли работает соединение с базой данных, нажмите кнопку <guibutton
>Проверить соединение</guibutton
>. Если всё работает, перейдите к разделу <guilabel
>Коллекции</guilabel
> и добавьте каталоги с фотографиями. Нажмите кнопку <guibutton
>OK</guibutton
> и дождитесь, когда в &digikam; появятся базы данных с данными из фотографий. Это может занять некоторое время, если в базу данных для регистрации предназначено большое количество элементов. </para>

            <para
>Есть несколько советов и рекомендаций для получения наилучших результатов при работе с удалённым сервером базы данных MySQL. </para>

            <para
>При медленном соединении &digikam; требуется много времени, особенно если альбом содержит много элементов (более 1000). Это решение зависит от работы сети. Обычно такое происходит при подключении по Wi-Fi, в таком случае рекомендуется использовать Ethernet. </para>

            <para
>При наличии огромной коллекции рекомендуется запустить сервер MySQL с командой <command
>mysql --max_allowed_packet = 128M</command
> (продвинутые пользователи могут также менять параметры в файлах my.ini или ~/.my.cnf). </para>

        </sect4>

    </sect3>

    <sect3 id="using-setup-database-migration">
        <title
>Преобразование базы данных</title>

        <para
>Приложение для управления фотографиями предлагает эксклюзивный инструмент «Преобразование базы данных», который позволяет пользователям переносить свои данные. Предположим, используется SQLite, а все данные требуется перенести в базу данных MySQL; для этого и нужен данный инструмент. Он помогает перенести данные из SQLite в MySQL и наоборот. </para>

        <para
>Чтобы переключиться на другую базу данных, перейдите в <menuchoice
><guimenu
>Настройка</guimenu
> <guimenuitem
>Преобразование базы данных...</guimenuitem
></menuchoice
>. Появится диалог: </para>

        <para>
            <inlinemediaobject
><imageobject>
                <imagedata fileref="&path;intro-database-migration.png" format="PNG"/></imageobject>
            </inlinemediaobject>
        </para>

        <para
>Теперь выберите соответствующий тип базы данных, в который надо преобразовать текущую. После этого нажмите кнопку <guibutton
>Перенести</guibutton
>, чтобы преобразовать базу данных из SQLite в MySQL (или наоборот). </para>

    </sect3>

    <sect3 id="using-setup-database-backup">
        <title
>Рекомендации по резервному копированию базы данных</title>

        <para
>По соображениям безопасности планирование резервного копирования базы данных с помощью crontab по сети может помочь предотвратить сбои в работе устройств. Для этого также возможно использовать систему NAS или внешний накопитель. </para>

        <para
>Каждая база данных может быть названа другим именем, не обязательно «digikam». Это позволяет создавать резервные копии только нужных элементов. Например, если назвать основную базу данных «digikamCore», это позволит отделить только эту таблицу (самый важный файл). Миниатюры и базы данных распознавания всегда возможно восстановить с нуля. </para>

        <para
>В разделе «<link linkend="tool-maintenance"
>Инструмент обслуживания</link
>» представлена информация о том, как управлять содержимым баз данных и как синхронизировать коллекции с информацией из баз данных (и наоборот). </para>

    </sect3>

    <sect3 id="using-setup-database-statistics">
        <title
>Статистика базы данных</title>

        <para
>&digikam; предоставляет уникальный инструмент для управления статистикой коллекции. Он включает в себя счётчик изображений, видео (а также индивидуальный счётчик по формату изображений), метки и так далее, а также серверную часть базы данных (QSQLITE или QMYSQL) и расположение баз данных (где находится коллекция). </para>

        <para
>Чтобы просмотреть статистику, воспользуйтесь меню <menuchoice
><guimenu
>Справка</guimenu
> <guimenuitem
>Статистика базы данных</guimenuitem
></menuchoice
>. Появится следующий диалог: </para>

        <para>
            <inlinemediaobject
><imageobject>
                <imagedata fileref="&path;intro-database-statistics.png" format="PNG"/></imageobject>
            </inlinemediaobject>
        </para>

    </sect3>

</sect2>

<!--
Local Variables:
mode: sgml
sgml-omittag: nil
sgml-shorttag: t
End:
-->
